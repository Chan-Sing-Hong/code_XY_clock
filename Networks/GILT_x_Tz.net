T   : u, L, R, d, qnum
Ql  : l, L
Qr  : R, r
TOUT: u, l; r, d, qnum

#                   u                                u
#               ┌───┘                           ┌────┘
#               │ ┏━╳━┓                         │ ┏━╳━━┓
#      ┏━╳━━┓   └>┨   ┃     ┏━╳━━┓              └>┨    ┃  
#   l─>┨ Ql ┠>─L─>┨ T ┠>─R─>┨ Qr ┠>r    ──>    l─>┨TOUT┠>─r
#      ┗━━━━┛     ┃   ┠>┐   ┗━━━━┛                ┃    ┠>┐
#                 ┗━━━┛ │                         ┗━━━━┛ │
#                   ┌───┘                            ┌───┘
#                   d                                d