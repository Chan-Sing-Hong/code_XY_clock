T     : u, l, r, d
g_u   : U, u
g_r   : r, R
g_d   : d, D
Tref.T: U, L, R, D
TOUT  : l; L

#          U
#     ┌────┘
#     │ ┏━━╳━━┓ 
#     └>┨ g_u ┠>┐
#       ┗━━━━━┛ │
#     ┌────u────┘
#     │ ┏━━╳━━┓
#     └>┨     ┃    ┏━━╳━━┓                  ┏━━╳━┓
#   l──>┨  T  ┠>─r>┨ g_r ┠>─R    =     l───>┨TOUT┠>───L
#       ┃     ┠>┐  ┗━━━━━┛                  ┗━━━━┛
#       ┗━━━━━┛ │
#     ┌────d────┘
#     │ ┏━━╳━━┓
#     └>┨ g_d ┠>┐
#       ┗━━━━━┛ │
#          ┌────┘
#          D
#
#          U
#    ┌─────┘
#    │ ┏━━━╳━━┓
#    └<┨      ┃
#  L──<┨Tref.T┠<──R
#      ┃      ┠<┐
#      ┗━━━━━━┛ │
#          ┌────┘
#          D