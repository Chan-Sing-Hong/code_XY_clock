T     : u, l, r, d 
g_l   : L, l
g_r   : r, R
g_d   : d, D
Tref.T: U, L, R, D
TOUT  : u; U

#                  u
#             ┌────┘
#             │ ┏━━╳━━┓
#    ┏━━╳━━┓  └>┨     ┃    ┏━━╳━━┓                  ┏━━╳━┓
# L─>┨ g_l ┠>l─>┨  T  ┠>─r>┨ g_r ┠>─R    =     u───>┨TOUT┠>───U
#    ┗━━━━━┛    ┃     ┠>┐  ┗━━━━━┛                  ┗━━━━┛
#               ┗━━━━━┛ │
#             ┌────d────┘
#             │ ┏━━╳━━┓
#             └>┨ g_d ┠>┐
#               ┗━━━━━┛ │
#                  ┌────┘
#                  D
#
#                  U
#            ┌─────┘
#            │ ┏━━━╳━━┓
#            └<┨      ┃
#          L──<┨Tref.T┠<──R
#              ┃      ┠<┐
#              ┗━━━━━━┛ │
#                  ┌────┘
#                  D